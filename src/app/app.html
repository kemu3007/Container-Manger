<main class="app">
  <header class="hero">
    <div>
      <p class="eyebrow">Container Manager</p>
    </div>
  </header>
  <section class="dashboard">
    <section class="pane panel-stack">
        <div class="pane-header">
          <div>
            <h2>Containers</h2>
          </div>
          <div class="group-actions">
            <button class="icon-btn" (click)="refreshContainers()" title="更新" aria-label="更新">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path
                  d="M20 12a8 8 0 1 1-2.34-5.66l1.42-1.42A10 10 0 1 0 22 12h-2z"
                  fill="currentColor"
                />
                <path d="M20 3v6h-6l2.2-2.2L20 3z" fill="currentColor" />
              </svg>
            </button>
            <button class="icon-btn" title="一括起動" aria-label="一括起動" (click)="startAll()">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M8 5l11 7-11 7V5z" fill="currentColor" />
              </svg>
            </button>
            <button class="icon-btn" title="一括停止" aria-label="一括停止" (click)="stopAll()">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M7 6h10v12H7z" fill="currentColor" />
              </svg>
            </button>
            <button class="icon-btn danger" title="一括削除" aria-label="一括削除" (click)="removeAll()">
              <svg viewBox="0 0 24 24" aria-hidden="true">
                <path d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9z" fill="currentColor" />
              </svg>
            </button>
          </div>
        </div>

        @if (loading()) {
          <div class="status">読み込み中…</div>
        } @else if (error()) {
          <div class="status error">{{ error() }}</div>
        } @else if (groups().length === 0) {
          <div class="status">稼働中のコンテナはありません。</div>
        }

        <div class="group-list">
          @for (group of groups(); track group.id) {
            <article class="group-card">
              <header>
                <div>
                  <button class="group-toggle" (click)="toggleGroup(group)" title="展開/収納" aria-label="展開/収納">
                    <span class="toggle-icon" [class.open]="!group.collapsed">▸</span>
                    <div>
                      <h3>{{ group.name }}</h3>
                      <p>Compose: {{ group.name }}</p>
                    </div>
                  </button>
                </div>
                <div class="group-header-right">
                  <div class="group-meta">{{ group.status }}</div>
                  <div class="group-actions">
                    <button class="icon-btn" title="更新" aria-label="更新" (click)="refreshContainers()">
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M20 12a8 8 0 1 1-2.34-5.66l1.42-1.42A10 10 0 1 0 22 12h-2z"
                          fill="currentColor"
                        />
                        <path d="M20 3v6h-6l2.2-2.2L20 3z" fill="currentColor" />
                      </svg>
                    </button>
                    <button
                      class="icon-btn"
                      title="compose logs"
                      aria-label="compose logs"
                      (click)="showComposeLogs(group)"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M4 5h16v14H4V5zm3 3v2h6V8H7zm0 4v2h10v-2H7z" fill="currentColor" />
                      </svg>
                    </button>
                    <button
                      class="icon-btn"
                      title="compose inspect"
                      aria-label="compose inspect"
                      (click)="showComposeInspect(group)"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M11 4a7 7 0 1 0 4.24 12.6l3.08 3.07 1.41-1.41-3.07-3.08A7 7 0 0 0 11 4zm0 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10z"
                          fill="currentColor"
                        />
                      </svg>
                    </button>
                    <button
                      class="icon-btn"
                      title="compose dir"
                      aria-label="compose dir"
                      [disabled]="!group.composeDir"
                      (click)="openComposeDirectory(group)"
                    >
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M3 6h7l2 2h9v10H3V6zm2 2v8h14V10H11L9 8H5z" fill="currentColor" />
                      </svg>
                    </button>
                    <button class="icon-btn" title="起動" aria-label="起動" (click)="startGroup(group)">
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M8 5l11 7-11 7V5z" fill="currentColor" />
                      </svg>
                    </button>
                    <button class="icon-btn" title="停止" aria-label="停止" (click)="stopGroup(group)">
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path d="M7 6h10v12H7z" fill="currentColor" />
                      </svg>
                    </button>
                    <button class="icon-btn danger" title="削除" aria-label="削除" (click)="removeGroup(group)">
                      <svg viewBox="0 0 24 24" aria-hidden="true">
                        <path
                          d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9z"
                          fill="currentColor"
                        />
                      </svg>
                    </button>
                  </div>
                </div>
              </header>
              @if (!group.collapsed) {
                <div class="table">
                  <div class="table-row header">
                    <div>NAME</div>
                    <div>IMAGE</div>
                    <div>STATUS</div>
                    <div>PORTS</div>
                    <div>ACTIONS</div>
                  </div>
                  @for (container of group.containers; track container.id) {
                    <div class="table-row">
                      <div class="mono">{{ container.name }}</div>
                      <div>{{ container.image }}</div>
                      <div>{{ container.status }}</div>
                      <div>{{ container.ports }}</div>
                      <div class="actions">
                        <button
                          class="icon-btn"
                          [disabled]="container.status.toLowerCase().includes('up')"
                          title="起動"
                          aria-label="起動"
                          (click)="startContainer(container)"
                        >
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M8 5l11 7-11 7V5z" fill="currentColor" />
                          </svg>
                        </button>
                        <button
                          class="icon-btn"
                          [disabled]="!container.status.toLowerCase().includes('up')"
                          title="停止"
                          aria-label="停止"
                          (click)="stopContainer(container)"
                        >
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path d="M7 6h10v12H7z" fill="currentColor" />
                          </svg>
                        </button>
                        <button
                          class="icon-btn danger"
                          title="削除"
                          aria-label="削除"
                          (click)="removeContainer(container)"
                        >
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                              d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9z"
                              fill="currentColor"
                            />
                          </svg>
                        </button>
                        <button class="icon-btn" (click)="showLog(container)" title="ログ" aria-label="ログ">
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                              d="M4 5h16v14H4V5zm3 3v2h6V8H7zm0 4v2h10v-2H7z"
                              fill="currentColor"
                            />
                          </svg>
                        </button>
                        <button class="icon-btn" title="inspect" aria-label="inspect" (click)="showInspect(container)">
                          <svg viewBox="0 0 24 24" aria-hidden="true">
                            <path
                              d="M11 4a7 7 0 1 0 4.24 12.6l3.08 3.07 1.41-1.41-3.07-3.08A7 7 0 0 0 11 4zm0 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10z"
                              fill="currentColor"
                            />
                          </svg>
                        </button>
                      </div>
                    </div>
                  }
                </div>
              }
            </article>
          }
        </div>
      </section>

      <section class="pane lower">
        <div class="pane panel-stack">
          <div class="pane-header">
            <div>
              <h2>Images</h2>
            </div>
            <div class="group-actions">
              <button class="icon-btn" (click)="refreshImages()" title="更新" aria-label="更新">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    d="M20 12a8 8 0 1 1-2.34-5.66l1.42-1.42A10 10 0 1 0 22 12h-2z"
                    fill="currentColor"
                  />
                  <path d="M20 3v6h-6l2.2-2.2L20 3z" fill="currentColor" />
                </svg>
              </button>
              <button class="icon-btn danger" (click)="removeAllImages()" title="一括削除" aria-label="一括削除">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9z"
                    fill="currentColor"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div class="asset-list">
            @for (image of images(); track image.id) {
              <div class="asset-row">
                <div>
                  <p class="asset-name">{{ image.name }}</p>
                  <p class="asset-meta">{{ image.size }} ・ {{ image.updatedAt }}</p>
                </div>
                <div class="asset-actions">
                  <button class="icon-btn danger" (click)="removeImage(image)" title="削除" aria-label="削除">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9z"
                        fill="currentColor"
                      />
                    </svg>
                  </button>
                  <button class="icon-btn" (click)="showImageInspect(image)" title="inspect" aria-label="inspect">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M11 4a7 7 0 1 0 4.24 12.6l3.08 3.07 1.41-1.41-3.07-3.08A7 7 0 0 0 11 4zm0 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10z"
                        fill="currentColor"
                      />
                    </svg>
                  </button>
                </div>
              </div>
            }
            @if (images().length === 0) {
              <div class="empty-row">Images がありません。</div>
            }
          </div>
        </div>

        <div class="pane panel-stack">
          <div class="pane-header">
            <div>
              <h2>Volumes</h2>
            </div>
            <div class="group-actions">
              <button class="icon-btn" (click)="refreshVolumes()" title="更新" aria-label="更新">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    d="M20 12a8 8 0 1 1-2.34-5.66l1.42-1.42A10 10 0 1 0 22 12h-2z"
                    fill="currentColor"
                  />
                  <path d="M20 3v6h-6l2.2-2.2L20 3z" fill="currentColor" />
                </svg>
              </button>
              <button class="icon-btn danger" (click)="removeAllVolumes()" title="一括削除" aria-label="一括削除">
                <svg viewBox="0 0 24 24" aria-hidden="true">
                  <path
                    d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9z"
                    fill="currentColor"
                  />
                </svg>
              </button>
            </div>
          </div>
          <div class="asset-list">
            @for (volume of volumes(); track volume.id) {
              <div class="asset-row">
                <div>
                  <p class="asset-name">{{ volume.name }}</p>
                  <p class="asset-meta">{{ volume.size }} ・ {{ volume.updatedAt }}</p>
                </div>
                <div class="asset-actions">
                  <button class="icon-btn danger" (click)="removeVolume(volume)" title="削除" aria-label="削除">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M9 3h6l1 2h4v2H4V5h4l1-2zm1 6h2v9h-2V9zm4 0h2v9h-2V9z"
                        fill="currentColor"
                      />
                    </svg>
                  </button>
                  <button class="icon-btn" (click)="showVolumeInspect(volume)" title="inspect" aria-label="inspect">
                    <svg viewBox="0 0 24 24" aria-hidden="true">
                      <path
                        d="M11 4a7 7 0 1 0 4.24 12.6l3.08 3.07 1.41-1.41-3.07-3.08A7 7 0 0 0 11 4zm0 2a5 5 0 1 1 0 10 5 5 0 0 1 0-10z"
                        fill="currentColor"
                      />
                    </svg>
                  </button>
                </div>
              </div>
            }
            @if (volumes().length === 0) {
              <div class="empty-row">Volumes がありません。</div>
            }
          </div>
        </div>
      </section>
  </section>


  @if (showInspectModal()) {
    <div class="modal-backdrop" (click)="closeInspectModal()">
      <div class="modal" (click)="$event.stopPropagation()">
        <header class="modal-header">
          <div>
            <h2>Inspect</h2>
            <p>{{ inspectTitle() }}</p>
          </div>
          <button class="icon-btn" (click)="closeInspectModal()" aria-label="閉じる" title="閉じる">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" />
            </svg>
          </button>
        </header>
        <div class="inspect-table">
          <div class="inspect-row header">
            <div>KEY</div>
            <div>VALUE</div>
          </div>
          @for (row of inspectRows(); track row.key) {
            <div class="inspect-row">
              <div class="mono">{{ row.key }}</div>
              <div>{{ row.value }}</div>
            </div>
          }
        </div>
      </div>
    </div>
  }

  @if (showLogModal()) {
    <div class="modal-backdrop" (click)="closeLogModal()">
      <div class="modal log-modal" (click)="$event.stopPropagation()">
        <header class="modal-header">
          <div>
            <h2>Logs</h2>
            <p>{{ selectedLogTitle() }}</p>
          </div>
          <button class="icon-btn" (click)="closeLogModal()" aria-label="閉じる" title="閉じる">
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M6 6l12 12M18 6l-12 12" stroke="currentColor" stroke-width="2" />
            </svg>
          </button>
        </header>
        <div class="log-panel">
          <pre>{{ selectedLog() || 'ログはここに表示されます。' }}</pre>
        </div>
      </div>
    </div>
  }
</main>
